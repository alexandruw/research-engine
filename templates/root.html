{% extends "base.html" %}

{% block head %}
<title>{{APP_NAME}}</title>
{% endblock %}


{% block content %}

{% if user %}

<div class="container">
  <div class="row">

    <div class="col-md-7">
      {% if recent_actv["Projects"] %}
      <form role="form" method="post">
	<button type="submit" class="btn btn-default pull-right">Mark everything as read</button>
	<input type="hidden" name="action" value="MarkProjectActvAsRead" />
      </form>
      {% endif %}
      <h2>Recent activity</h2>
      {% if recent_actv["Projects"] %}
      {% for p_key in recent_actv["Projects"] %}
      <div class="panel panel-default">
	<div class="panel-heading">
	  <a href="/{{recent_actv['Projects'][p_key][0].key.integer_id()}}" 
	     class="panel-title">{{recent_actv["Projects"][p_key][0].name | safe}}</a></div>
	<ul class="list-group">
	  {% for a in recent_actv["Projects"][p_key][1] %}
	  <li class="list-group-item"><small class="text-muted">{{a.date.strftime("%d-%b-%Y")}}</small> {{a.description_html() | safe}}</li>
	  {% endfor %}
	</ul>
      </div>
      {% endfor %}
      {% else %}
      <p>There's no recent activity in your projects</p>
      {% endif %}
    </div>

    <div class="col-md-5">


      <div class="panel panel-primary">
	<div class="panel-heading">
	  <h3 class="panel-title">Your projects</h3>
	</div>

	<div class="panel-body">
	  <div class="panel-group" id="accordion1">
	    {% for p in projects %}
	    <div class="panel panel-default">
	      <div class="panel-heading">
		<h4 class="panel-title">
		  <a class="accordion-toggle pull-right" data-toggle="collapse" data-parent="#accordion1" href="#{{p.key.integer_id()}}">
		    <span class="glyphicon glyphicon-info-sign"></span></a>
		  <a href="/{{p.key.integer_id()}}">{{p.name | safe}}</a>
		</h4>
	      </div>
	      <div class="panel-collapse collapse" id="{{p.key.integer_id()}}">  
		<div class="panel-body">
		  {{p.description | md | safe}}
		  <p class="text-muted pull-right">Last updated: {{p.last_updated.strftime("%d-%b-%Y")}}</p>
		</div>
	      </div>
	    </div>
	    {% endfor %}
	    <div class="panel">
	      <a class="btn btn-success pull-right" href="/new_project"><span class="glyphicon glyphicon-plus"></span> New project</a>
	    </div>
	  </div>
	</div>
      </div>

    </div>
    
  </div>
</div>

{% else %}
<p style="text-align:right; font-size:0.9em; ">You are not logged in. You can <a href="/login">login here</a> or <a href="/signup">signup</a> for a new account. It's free!</p>

{% endif %}

{% endblock %}
