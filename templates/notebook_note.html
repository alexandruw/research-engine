{% extends "project_base.html" %}


{% block p_head %}
<script type="text/javascript" src="/js/showdown.js"></script>
<script type="text/javascript" src="/js/preview.js"></script>
{% endblock %}

{% block breadcrumbs %}<li><a href="/{{project.key.integer_id()}}/notebooks">Notebooks</a></li><li><a href="/{{project.key.integer_id()}}/notebooks/{{notebook.key.integer_id()}}">{{notebook.name | safe | truncate(40, True)}}</a></li><li class="active">{{note.title | safe | truncate(40, True)}}</li>
{% endblock %}

{% block p_content %}
{% if visible_p %}
<div class="panel panel-default">
  <div class="panel-heading" style="overflow:auto;">
    {% if user_is_owner_p %}
    <a class="btn btn-default btn-sm pull-right" href="/{{project.key.integer_id()}}/notebooks/{{notebook.key.integer_id()}}/{{note.key.integer_id()}}/edit">
      <span class="glyphicon glyphicon-pencil"></span>
    </a>
    {% endif %}
    <h3 class="panel-title">{{note.title}}</h3>
  </div>
  <div class="panel-body">
    {{note.content | md | safe}}
    <small class="text-muted">{{note.date.strftime("%d %b %Y")}}</small>
  </div>
</div>

<h3 class="page-header" id="comments">Comments</h3>
<div class="list-group">
  {% for c in comments %}
  <div class="list-group-item">
    {{c.comment | md | safe}}
    <a href="/{{c.author.get().username}}"><img src="{{c.author.get().get_profile_image(20)}}" /> {{c.author.get().username.capitalize()}}</a>
    <small class="text-muted pull-right">{{c.date.strftime("%d %b %Y")}}</small>
  </div>
  {% endfor %}
</div>

<form method="post" role="form">
  <div class="form-group">
    <textarea id="commentText" name="comment" class="form-control" rows="7"
	      onKeyUp="Preview('commentText','previewArea');"{% if visitor_p %} disabled{% endif %}{% if new_comment %} autofocus{% endif %}>{{comment_value}}</textarea>
  </div>
  <span class="help-block">Click <a href="/static/edit_help.html" target="_blank">here</a> to view some editing help (opens in a new window).</span>
  <button type="submit" class="btn btn-success"{% if visitor_p %}disabled{% endif %}>Comment</button>
  {% if error_message %}
  <div class="alert alert-danger alert-dismissable" style="margin-top:10px;">
    <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>{{error_message}}</div>{% endif %}
  {% if visitor_p %}<p class="text-warning">{% if user %}You are not a member of this project{% else %}Please log in to make a comment{% endif %}</p>{% endif %} 
</form>

<div style="margin-top:10px;">This is a preview of how the page will be renderer when you save it. It may not be 100&#37; accurate but it should be close.</div>
<div class="panel panel-default">
  <div class="panel-body" id="previewArea"><em>Start typing above to see the preview here.</em></div>
</div>

{% else %}<!-- not visible_p -->
<div class="alert alert-danger">{{error_message}}</div>
{% endif %}
{% endblock %}
